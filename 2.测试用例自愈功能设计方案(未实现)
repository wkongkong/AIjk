æµ‹è¯•ç”¨ä¾‹è‡ªæ„ˆåŠŸèƒ½è®¾è®¡æ–¹æ¡ˆ
æ•´ä½“æ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æµ‹è¯•ç”¨ä¾‹è‡ªæ„ˆé—­ç¯                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                     â–¼                     â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æ‰§è¡Œç”¨ä¾‹ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ åˆ†ææŠ¥å‘Š â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ è‡ªåŠ¨ä¿®å¤ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
   AllureæŠ¥å‘Š          AIåˆ†æå¼•æ“           æ›´æ–°ç”¨ä¾‹åˆ°SVN
        â”‚                     â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                        éªŒè¯ä¿®å¤æ•ˆæœ
æ ¸å¿ƒè®¾è®¡æ€è·¯
1. æ‰§è¡Œé˜¶æ®µ - æ”¶é›†è¯¦ç»†ä¿¡æ¯
åœ¨ç°æœ‰çš„æ‰§è¡Œæ¡†æ¶åŸºç¡€ä¸Šï¼Œå¢å¼ºæ—¥å¿—æ”¶é›†ï¼š

# 3.æ¥å£ç”¨ä¾‹è„šæœ¬æ‰§è¡Œæ¡†æ¶/api_autotest/core/test_executor.py

class EnhancedTestExecutor:
    """å¢å¼ºçš„æµ‹è¯•æ‰§è¡Œå™¨ï¼Œæ”¶é›†è‡ªæ„ˆæ‰€éœ€ä¿¡æ¯"""
    
    def execute_testcase(self, testcase):
        """æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹å¹¶æ”¶é›†è¯¦ç»†ä¿¡æ¯"""
        result = {
            'testcase_id': testcase['id'],
            'interface_id': testcase['interface_id'],
            'collection_id': testcase['collection_id'],
            'status': None,  # passed/failed/error
            'execution_time': None,
            'request': {
                'method': None,
                'url': None,
                'headers': None,
                'params': None,
                'body': None
            },
            'response': {
                'status_code': None,
                'headers': None,
                'body': None,
                'time': None
            },
            'assertions': [],  # æ¯ä¸ªæ–­è¨€çš„ç»“æœ
            'error': {
                'type': None,  # connection/timeout/assertion/validation
                'message': None,
                'traceback': None
            },
            'context': {
                'api_doc': None,  # åŸå§‹APIæ–‡æ¡£
                'testcase_yaml': None  # æµ‹è¯•ç”¨ä¾‹YAML
            }
        }
        
        try:
            # æ‰§è¡Œè¯·æ±‚
            response = self.send_request(testcase)
            result['response'] = self.extract_response_info(response)
            
            # æ‰§è¡Œæ–­è¨€
            for assertion in testcase['assertions']:
                assertion_result = self.run_assertion(assertion, response)
                result['assertions'].append(assertion_result)
                
            result['status'] = 'passed' if all(a['passed'] for a in result['assertions']) else 'failed'
            
        except Exception as e:
            result['status'] = 'error'
            result['error'] = self.extract_error_info(e)
            
        # ä¿å­˜åˆ°è‡ªæ„ˆæ•°æ®åº“
        self.save_for_healing(result)
        
        return result
2. åˆ†æé˜¶æ®µ - AIæ™ºèƒ½è¯Šæ–­
åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„AIåˆ†ææœåŠ¡ï¼Œè§£æå¤±è´¥åŸå› ï¼š

# 1.APIæ–‡æ¡£è§£ææœåŠ¡å¹³å°/app/healing_analyzer.py

class HealingAnalyzer:
    """æµ‹è¯•ç”¨ä¾‹è‡ªæ„ˆåˆ†æå™¨"""
    
    def __init__(self, dify_client):
        self.dify_client = dify_client
        
    def analyze_failure(self, test_result):
        """åˆ†ææµ‹è¯•å¤±è´¥åŸå› å¹¶ç”Ÿæˆä¿®å¤å»ºè®®"""
        
        # æ„å»ºåˆ†ææç¤ºè¯
        analysis_prompt = self._build_analysis_prompt(test_result)
        
        # è°ƒç”¨Dify AIåˆ†æ
        analysis = self.dify_client.analyze_test_failure(analysis_prompt)
        
        return {
            'failure_category': analysis['category'],  # æ–­è¨€é”™è¯¯/æ•°æ®é—®é¢˜/ç¯å¢ƒé—®é¢˜/æ¥å£å˜æ›´
            'root_cause': analysis['root_cause'],
            'fix_suggestions': analysis['suggestions'],
            'confidence': analysis['confidence'],  # 0-1ï¼Œä¿®å¤å»ºè®®çš„ç½®ä¿¡åº¦
            'auto_fixable': analysis['auto_fixable']  # æ˜¯å¦å¯è‡ªåŠ¨ä¿®å¤
        }
    
    def _build_analysis_prompt(self, test_result):
        """æ„å»ºAIåˆ†ææç¤ºè¯"""
        return f"""
# æµ‹è¯•ç”¨ä¾‹å¤±è´¥åˆ†æ

## æ¥å£ä¿¡æ¯
- æ¥å£è·¯å¾„: {test_result['request']['url']}
- è¯·æ±‚æ–¹æ³•: {test_result['request']['method']}
- æ¥å£æ–‡æ¡£: {test_result['context']['api_doc']}

## æµ‹è¯•ç”¨ä¾‹
```yaml
{test_result['context']['testcase_yaml']}
æ‰§è¡Œç»“æœ
çŠ¶æ€ç : {test_result['response']['status_code']}
å“åº”æ—¶é—´: {test_result['response']['time']}ms
å“åº”ä½“: {test_result['response']['body']}
å¤±è´¥æ–­è¨€
{self._format_failed_assertions(test_result['assertions'])}

é”™è¯¯ä¿¡æ¯
ç±»å‹: {test_result['error']['type']}
æ¶ˆæ¯: {test_result['error']['message']}
è¯·åˆ†æå¤±è´¥åŸå› ï¼Œå¹¶ç»™å‡ºä¿®å¤å»ºè®®ã€‚é‡ç‚¹å…³æ³¨ï¼š

æ˜¯å¦æ˜¯æ–­è¨€æ¡ä»¶è®¾ç½®ä¸åˆç†ï¼Ÿ
æ˜¯å¦æ˜¯æµ‹è¯•æ•°æ®é—®é¢˜ï¼Ÿ
æ˜¯å¦æ˜¯æ¥å£è¿”å›æ ¼å¼å˜åŒ–ï¼Ÿ
æ˜¯å¦æ˜¯ç¯å¢ƒé…ç½®é—®é¢˜ï¼Ÿ
è¾“å‡ºJSONæ ¼å¼ï¼š {{ "category": "æ–­è¨€é”™è¯¯|æ•°æ®é—®é¢˜|ç¯å¢ƒé—®é¢˜|æ¥å£å˜æ›´", "root_cause": "è¯¦ç»†åŸå› åˆ†æ", "suggestions": ["ä¿®å¤å»ºè®®1", "ä¿®å¤å»ºè®®2"], "confidence": 0.85, "auto_fixable": true, "fix_actions": [ {{ "type": "update_assertion", "target": "status_code", "old_value": 200, "new_value": 201, "reason": "æ¥å£è¿”å›201è€Œé200" }} ] }} """


#### 3. **ä¿®å¤é˜¶æ®µ - è‡ªåŠ¨ä¿®å¤ç­–ç•¥**

æ ¹æ®åˆ†æç»“æœï¼Œè‡ªåŠ¨ä¿®å¤æµ‹è¯•ç”¨ä¾‹ï¼š

```python
# 1.APIæ–‡æ¡£è§£ææœåŠ¡å¹³å°/app/healing_fixer.py

class HealingFixer:
    """æµ‹è¯•ç”¨ä¾‹è‡ªåŠ¨ä¿®å¤å™¨"""
    
    FIXABLE_CATEGORIES = {
        'assertion_error': ['update_assertion', 'add_assertion', 'remove_assertion'],
        'data_format': ['update_extract', 'update_validation'],
        'status_code': ['update_expected_status'],
        'response_schema': ['update_schema_validation'],
        'timeout': ['increase_timeout', 'add_retry']
    }
    
    def auto_fix(self, test_result, analysis):
        """è‡ªåŠ¨ä¿®å¤æµ‹è¯•ç”¨ä¾‹"""
        
        if not analysis['auto_fixable'] or analysis['confidence'] < 0.7:
            return {
                'fixed': False,
                'reason': 'ç½®ä¿¡åº¦ä¸è¶³æˆ–æ— æ³•è‡ªåŠ¨ä¿®å¤',
                'manual_review_required': True
            }
        
        # åŠ è½½åŸå§‹æµ‹è¯•ç”¨ä¾‹
        testcase = self.load_testcase(
            test_result['collection_id'],
            test_result['interface_id']
        )
        
        # åº”ç”¨ä¿®å¤åŠ¨ä½œ
        fixed_testcase = testcase.copy()
        fix_log = []
        
        for action in analysis['fix_actions']:
            if action['type'] == 'update_assertion':
                self._fix_assertion(fixed_testcase, action)
                fix_log.append(f"æ›´æ–°æ–­è¨€: {action['target']} {action['old_value']} â†’ {action['new_value']}")
                
            elif action['type'] == 'update_expected_status':
                self._fix_status_code(fixed_testcase, action)
                fix_log.append(f"æ›´æ–°æœŸæœ›çŠ¶æ€ç : {action['old_value']} â†’ {action['new_value']}")
                
            elif action['type'] == 'update_extract':
                self._fix_extract(fixed_testcase, action)
                fix_log.append(f"æ›´æ–°æ•°æ®æå–: {action['field']}")
                
            elif action['type'] == 'add_retry':
                self._add_retry_config(fixed_testcase, action)
                fix_log.append(f"æ·»åŠ é‡è¯•é…ç½®: {action['retry_times']}æ¬¡")
        
        # éªŒè¯ä¿®å¤åçš„ç”¨ä¾‹
        validation = self._validate_fixed_testcase(fixed_testcase)
        
        if validation['valid']:
            # ä¿å­˜ä¿®å¤åçš„ç”¨ä¾‹
            self.save_testcase(fixed_testcase)
            
            # æäº¤åˆ°SVN
            self.commit_to_svn(fixed_testcase, fix_log)
            
            return {
                'fixed': True,
                'fix_log': fix_log,
                'testcase': fixed_testcase,
                'validation': validation
            }
        else:
            return {
                'fixed': False,
                'reason': validation['error'],
                'manual_review_required': True
            }
    
    def _fix_assertion(self, testcase, action):
        """ä¿®å¤æ–­è¨€"""
        for assertion in testcase['test']['validate']:
            if assertion['check'] == action['target']:
                assertion['expected'] = action['new_value']
                assertion['_fix_reason'] = action['reason']
                assertion['_fixed_at'] = datetime.now().isoformat()
                break
    
    def _fix_status_code(self, testcase, action):
        """ä¿®å¤çŠ¶æ€ç æœŸæœ›"""
        for assertion in testcase['test']['validate']:
            if assertion['check'] == 'status_code':
                assertion['expected'] = action['new_value']
                break
4. éªŒè¯é˜¶æ®µ - è‡ªåŠ¨é‡è·‘éªŒè¯
ä¿®å¤åè‡ªåŠ¨é‡æ–°æ‰§è¡Œï¼ŒéªŒè¯ä¿®å¤æ•ˆæœï¼š

# 1.APIæ–‡æ¡£è§£ææœåŠ¡å¹³å°/app/healing_validator.py

class HealingValidator:
    """è‡ªæ„ˆéªŒè¯å™¨"""
    
    def validate_fix(self, fixed_testcase, original_result):
        """éªŒè¯ä¿®å¤æ•ˆæœ"""
        
        # é‡æ–°æ‰§è¡Œä¿®å¤åçš„ç”¨ä¾‹
        new_result = self.executor.execute_testcase(fixed_testcase)
        
        validation = {
            'success': new_result['status'] == 'passed',
            'original_status': original_result['status'],
            'new_status': new_result['status'],
            'execution_time': new_result['execution_time'],
            'comparison': self._compare_results(original_result, new_result)
        }
        
        if validation['success']:
            # ä¿®å¤æˆåŠŸï¼Œæ›´æ–°ç”¨ä¾‹çŠ¶æ€
            self._mark_as_healed(fixed_testcase, validation)
        else:
            # ä¿®å¤å¤±è´¥ï¼Œæ ‡è®°éœ€è¦äººå·¥ä»‹å…¥
            self._mark_for_manual_review(fixed_testcase, validation)
        
        return validation
    
    def _compare_results(self, original, new):
        """å¯¹æ¯”ä¿®å¤å‰åçš„æ‰§è¡Œç»“æœ"""
        return {
            'status_changed': original['status'] != new['status'],
            'response_time_diff': new['response']['time'] - original['response']['time'],
            'assertions_fixed': [
                a for a in new['assertions'] 
                if a['passed'] and not self._was_passed_before(a, original)
            ]
        }
5. å‰ç«¯ç•Œé¢è®¾è®¡
åœ¨ç°æœ‰ç•Œé¢åŸºç¡€ä¸Šï¼Œæ·»åŠ è‡ªæ„ˆåŠŸèƒ½å…¥å£ï¼š

<!-- 1.APIæ–‡æ¡£è§£ææœåŠ¡å¹³å°/app/templates/healing_dashboard.html -->

<div class="healing-dashboard">
    <h2>ğŸ”§ æµ‹è¯•ç”¨ä¾‹è‡ªæ„ˆä¸­å¿ƒ</h2>
    
    <!-- è‡ªæ„ˆç»Ÿè®¡ -->
    <div class="healing-stats">
        <div class="stat-card">
            <div class="stat-value">{{ total_failures }}</div>
            <div class="stat-label">å¤±è´¥ç”¨ä¾‹</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ auto_fixed }}</div>
            <div class="stat-label">è‡ªåŠ¨ä¿®å¤</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ success_rate }}%</div>
            <div class="stat-label">ä¿®å¤æˆåŠŸç‡</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ pending_review }}</div>
            <div class="stat-label">å¾…äººå·¥å®¡æ ¸</div>
        </div>
    </div>
    
    <!-- å¤±è´¥ç”¨ä¾‹åˆ—è¡¨ -->
    <div class="failed-testcases">
        <table>
            <thead>
                <tr>
                    <th>æ¥å£</th>
                    <th>ç”¨ä¾‹åç§°</th>
                    <th>å¤±è´¥åŸå› </th>
                    <th>AIåˆ†æ</th>
                    <th>ä¿®å¤å»ºè®®</th>
                    <th>ç½®ä¿¡åº¦</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for failure in failures %}
                <tr>
                    <td>{{ failure.interface_path }}</td>
                    <td>{{ failure.testcase_name }}</td>
                    <td>{{ failure.error_type }}</td>
                    <td>
                        <button onclick="viewAnalysis('{{ failure.id }}')">
                            æŸ¥çœ‹åˆ†æ
                        </button>
                    </td>
                    <td>{{ failure.fix_suggestions | length }} æ¡å»ºè®®</td>
                    <td>
                        <span class="confidence-badge confidence-{{ failure.confidence | confidence_level }}">
                            {{ (failure.confidence * 100) | round }}%
                        </span>
                    </td>
                    <td>
                        {% if failure.auto_fixable %}
                        <button class="btn-primary" onclick="autoFix('{{ failure.id }}')">
                            ğŸ¤– è‡ªåŠ¨ä¿®å¤
                        </button>
                        {% else %}
                        <button class="btn-warning" onclick="manualFix('{{ failure.id }}')">
                            âœï¸ äººå·¥ä¿®å¤
                        </button>
                        {% endif %}
                        <button onclick="ignoreFailure('{{ failure.id }}')">
                            å¿½ç•¥
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- ä¿®å¤å†å² -->
    <div class="healing-history">
        <h3>ä¿®å¤å†å²</h3>
        <div class="timeline">
            {% for record in healing_history %}
            <div class="timeline-item">
                <div class="timeline-time">{{ record.fixed_at }}</div>
                <div class="timeline-content">
                    <strong>{{ record.testcase_name }}</strong>
                    <p>{{ record.fix_description }}</p>
                    <span class="badge badge-{{ record.status }}">
                        {{ record.status }}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
6. æ•°æ®åº“è®¾è®¡
å­˜å‚¨è‡ªæ„ˆç›¸å…³æ•°æ®ï¼š

-- å¤±è´¥è®°å½•è¡¨
CREATE TABLE test_failures (
    id VARCHAR(50) PRIMARY KEY,
    collection_id VARCHAR(50),
    interface_id VARCHAR(50),
    testcase_id VARCHAR(50),
    execution_id VARCHAR(50),
    failure_time TIMESTAMP,
    error_type VARCHAR(50),
    error_message TEXT,
    request_data JSON,
    response_data JSON,
    context_data JSON,
    status VARCHAR(20) -- pending/analyzing/fixed/ignored
);

-- AIåˆ†æç»“æœè¡¨
CREATE TABLE healing_analysis (
    id VARCHAR(50) PRIMARY KEY,
    failure_id VARCHAR(50),
    category VARCHAR(50),
    root_cause TEXT,
    suggestions JSON,
    fix_actions JSON,
    confidence FLOAT,
    auto_fixable BOOLEAN,
    analyzed_at TIMESTAMP
);

-- ä¿®å¤è®°å½•è¡¨
CREATE TABLE healing_records (
    id VARCHAR(50) PRIMARY KEY,
    failure_id VARCHAR(50),
    analysis_id VARCHAR(50),
    fix_type VARCHAR(20), -- auto/manual
    fix_actions JSON,
    fix_log TEXT,
    old_testcase JSON,
    new_testcase JSON,
    validation_result JSON,
    fixed_at TIMESTAMP,
    fixed_by VARCHAR(50),
    status VARCHAR(20) -- success/failed/pending_validation
);
7. å·¥ä½œæµç¨‹
1. Jenkinsæ‰§è¡Œæµ‹è¯• â†’ ç”ŸæˆAllureæŠ¥å‘Š
                â†“
2. è§£ææŠ¥å‘Šï¼Œæå–å¤±è´¥ç”¨ä¾‹ä¿¡æ¯
                â†“
3. è°ƒç”¨AIåˆ†æå¤±è´¥åŸå› 
                â†“
4. ç”Ÿæˆä¿®å¤å»ºè®®ï¼ˆç½®ä¿¡åº¦è¯„åˆ†ï¼‰
                â†“
5. åˆ¤æ–­æ˜¯å¦å¯è‡ªåŠ¨ä¿®å¤
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
        â–¼               â–¼
   å¯è‡ªåŠ¨ä¿®å¤      éœ€äººå·¥å®¡æ ¸
        â”‚               â”‚
        â–¼               â–¼
   è‡ªåŠ¨åº”ç”¨ä¿®å¤    å±•ç¤ºåœ¨ç•Œé¢
        â”‚               â”‚
        â–¼               â”‚
   é‡æ–°æ‰§è¡ŒéªŒè¯         â”‚
        â”‚               â”‚
        â–¼               â”‚
   ä¿®å¤æˆåŠŸï¼Ÿ           â”‚
    â”Œâ”€â”€â”´â”€â”€â”            â”‚
    â–¼     â–¼            â–¼
   æ˜¯    å¦      äººå·¥ä¿®å¤åæäº¤
    â”‚     â”‚            â”‚
    â””â”€â”€â”¬â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–¼
  æäº¤åˆ°SVNï¼Œæ›´æ–°ç”¨ä¾‹
       â–¼
  è§¦å‘å›å½’æµ‹è¯•éªŒè¯
8. é…ç½®æ–‡ä»¶
# healing_config.yaml

healing:
  enabled: true
  
  # è‡ªåŠ¨ä¿®å¤é…ç½®
  auto_fix:
    enabled: true
    confidence_threshold: 0.7  # ç½®ä¿¡åº¦é˜ˆå€¼
    max_retry: 3  # æœ€å¤§é‡è¯•æ¬¡æ•°
    
  # å¯è‡ªåŠ¨ä¿®å¤çš„é”™è¯¯ç±»å‹
  fixable_errors:
    - assertion_error
    - status_code_mismatch
    - response_format_change
    - timeout
    
  # éœ€è¦äººå·¥å®¡æ ¸çš„é”™è¯¯ç±»å‹
  manual_review_required:
    - api_contract_change
    - business_logic_error
    - security_issue
    
  # AIåˆ†æé…ç½®
  ai_analysis:
    provider: dify
    model: gpt-4
    max_tokens: 2000
    temperature: 0.3
    
  # éªŒè¯é…ç½®
  validation:
    auto_rerun: true
    rerun_delay: 5  # ç§’
    max_rerun: 2
    
  # é€šçŸ¥é…ç½®
  notification:
    enabled: true
    channels:
      - email
      - webhook
    recipients:
      - team@example.com
9. APIæ¥å£è®¾è®¡
# 1.APIæ–‡æ¡£è§£ææœåŠ¡å¹³å°/app/routes.py

@api_bp.route('/healing/analyze/<failure_id>', methods=['POST'])
def analyze_failure(failure_id):
    """åˆ†ææµ‹è¯•å¤±è´¥åŸå› """
    analyzer = HealingAnalyzer(current_app.config['DIFY_CLIENT'])
    failure = storage.get_failure(failure_id)
    analysis = analyzer.analyze_failure(failure)
    storage.save_analysis(failure_id, analysis)
    return jsonify({'success': True, 'analysis': analysis})

@api_bp.route('/healing/fix/<failure_id>', methods=['POST'])
def auto_fix_testcase(failure_id):
    """è‡ªåŠ¨ä¿®å¤æµ‹è¯•ç”¨ä¾‹"""
    fixer = HealingFixer()
    failure = storage.get_failure(failure_id)
    analysis = storage.get_analysis(failure_id)
    result = fixer.auto_fix(failure, analysis)
    
    if result['fixed']:
        # è§¦å‘éªŒè¯
        validator = HealingValidator()
        validation = validator.validate_fix(result['testcase'], failure)
        return jsonify({'success': True, 'result': result, 'validation': validation})
    else:
        return jsonify({'success': False, 'reason': result['reason']})

@api_bp.route('/healing/dashboard', methods=['GET'])
def healing_dashboard():
    """è‡ªæ„ˆä»ªè¡¨æ¿æ•°æ®"""
    stats = {
        'total_failures': storage.count_failures(),
        'auto_fixed': storage.count_fixed(fix_type='auto'),
        'manual_fixed': storage.count_fixed(fix_type='manual'),
        'pending_review': storage.count_pending(),
        'success_rate': storage.calculate_success_rate()
    }
    return jsonify({'success': True, 'stats': stats})
10. å…³é”®ä¼˜åŠ¿
æ™ºèƒ½åˆ†æï¼šåˆ©ç”¨AIæ·±åº¦åˆ†æå¤±è´¥åŸå› ï¼Œä¸åªæ˜¯ç®€å•çš„é”™è¯¯åŒ¹é…
ç½®ä¿¡åº¦è¯„åˆ†ï¼šå¯¹ä¿®å¤å»ºè®®è¿›è¡Œç½®ä¿¡åº¦è¯„ä¼°ï¼Œä½ç½®ä¿¡åº¦çš„è½¬äººå·¥å®¡æ ¸
é—­ç¯éªŒè¯ï¼šä¿®å¤åè‡ªåŠ¨é‡è·‘éªŒè¯ï¼Œç¡®ä¿ä¿®å¤æœ‰æ•ˆ
ç‰ˆæœ¬æ§åˆ¶ï¼šæ‰€æœ‰ä¿®å¤éƒ½æäº¤åˆ°SVNï¼Œå¯è¿½æº¯ã€å¯å›æ»š
æ¸è¿›å¼è‡ªæ„ˆï¼šä»ç®€å•é”™è¯¯å¼€å§‹ï¼Œé€æ­¥æ‰©å±•åˆ°å¤æ‚åœºæ™¯
äººæœºåä½œï¼šè‡ªåŠ¨ä¿®å¤ + äººå·¥å®¡æ ¸ï¼Œç¡®ä¿è´¨é‡
å®æ–½å»ºè®®
ç¬¬ä¸€é˜¶æ®µï¼ˆMVPï¼‰ï¼š

å®ç°å¤±è´¥ç”¨ä¾‹æ”¶é›†å’Œå±•ç¤º
æ¥å…¥AIåˆ†æï¼ˆç®€å•çš„æ–­è¨€é”™è¯¯ã€çŠ¶æ€ç é”™è¯¯ï¼‰
æ”¯æŒäººå·¥ä¿®å¤å¹¶è®°å½•
ç¬¬äºŒé˜¶æ®µï¼š

å®ç°è‡ªåŠ¨ä¿®å¤ï¼ˆé«˜ç½®ä¿¡åº¦åœºæ™¯ï¼‰
æ·»åŠ ä¿®å¤éªŒè¯æœºåˆ¶
å®Œå–„è‡ªæ„ˆä»ªè¡¨æ¿
ç¬¬ä¸‰é˜¶æ®µï¼š

æ‰©å±•å¯ä¿®å¤çš„é”™è¯¯ç±»å‹
ä¼˜åŒ–AIåˆ†ææ¨¡å‹
æ·»åŠ ä¿®å¤æ•ˆæœç»Ÿè®¡å’Œå­¦ä¹ 