# APIè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ - ä½¿ç”¨è¯´æ˜

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„APIè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œæ”¯æŒ**æ··åˆæµ‹è¯•æ¨¡å¼**ï¼š
- **é€šç”¨æ¨¡å¼**ï¼šæ‰¹é‡æµ‹è¯•ç”¨ä¾‹ï¼Œç»Ÿä¸€æ‰§è¡Œ
- **ç‹¬ç«‹æ¨¡å¼**ï¼šç‰¹æ®Šæµ‹è¯•ç”¨ä¾‹ï¼Œç‹¬ç«‹è„šæœ¬

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

âœ… **åŒæ ¼å¼æ”¯æŒ**ï¼šCSV å’Œ YAML æ ¼å¼æµ‹è¯•ç”¨ä¾‹
âœ… **æ··åˆæ¨¡å¼**ï¼šé€šç”¨æµ‹è¯• + ç‹¬ç«‹æµ‹è¯•å¹¶å­˜
âœ… **è‡ªåŠ¨è¯†åˆ«**ï¼šæ ¹æ®æ–‡ä»¶åè‡ªåŠ¨é€‰æ‹©æ‰§è¡Œæ¨¡å¼
âœ… **æ™ºèƒ½è®¤è¯**ï¼šè‡ªåŠ¨å¤„ç†ç™»å½•å’Œæƒé™
âœ… **è¯¦ç»†æŠ¥å‘Š**ï¼šAllure æµ‹è¯•æŠ¥å‘Š
âœ… **ä¸€é”®æ‰§è¡Œ**ï¼šåŒå‡»è¿è¡Œæ‰€æœ‰æµ‹è¯•

## ğŸ“ ç›®å½•ç»“æ„

```
api_autotest/
â”œâ”€â”€ data_csv/                      # CSVæ ¼å¼æµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ test_*.csv                 # é€šç”¨æ¨¡å¼ï¼ˆè‡ªåŠ¨æ‰§è¡Œï¼‰
â”‚   â””â”€â”€ dl_*.csv                   # ç‹¬ç«‹æ¨¡å¼ï¼ˆéœ€ç”Ÿæˆè„šæœ¬ï¼‰
â”‚
â”œâ”€â”€ data_yaml/                     # YAMLæ ¼å¼æµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ test_*.yaml                # é€šç”¨æ¨¡å¼ï¼ˆè‡ªåŠ¨æ‰§è¡Œï¼‰
â”‚   â””â”€â”€ dl_*.yaml                  # ç‹¬ç«‹æ¨¡å¼ï¼ˆéœ€ç”Ÿæˆè„šæœ¬ï¼‰
â”‚
â”œâ”€â”€ testcases/                     # æµ‹è¯•è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ test_common.py             # é€šç”¨æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ dl_*.py                    # ç‹¬ç«‹æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ conftest.py                # pytesté…ç½®
â”‚
â”œâ”€â”€ config/                        # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.yaml                # ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ config.py                  # é…ç½®åŠ è½½
â”‚
â”œâ”€â”€ core/                          # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ api_client.py              # APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ assertions.py              # æ–­è¨€å·¥å…·
â”‚   â””â”€â”€ logger.py                  # æ—¥å¿—å·¥å…·
â”‚
â”œâ”€â”€ utils/                         # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ data_handler.py            # æ•°æ®å¤„ç†
â”‚   â””â”€â”€ common.py                  # é€šç”¨å·¥å…·
â”‚
â”œâ”€â”€ docs/                          # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ authentication_guide.md    # è®¤è¯æŒ‡å—
â”‚   â””â”€â”€ captcha_guide.md           # éªŒè¯ç æŒ‡å—
â”‚
â”œâ”€â”€ run_test_data.bat              # ä¸€é”®æ‰§è¡Œè„šæœ¬ â­
â”œâ”€â”€ generate_dl_test.py            # ç‹¬ç«‹è„šæœ¬ç”Ÿæˆå·¥å…·
â”œâ”€â”€ requirements.txt               # ä¾èµ–åŒ…
â””â”€â”€ pytest.ini                     # pytesté…ç½®
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒ

ç¼–è¾‘ `config/config.yaml`ï¼š

```yaml
base_url: "http://your-api-server.com"
auth:
  username: "your_username"
  password: "your_password"
  token: "your_token"  # å¯é€‰ï¼šå›ºå®štoken
```

### 3. æ‰§è¡Œæµ‹è¯•

**æ–¹å¼1ï¼šåŒå‡»è¿è¡Œï¼ˆæ¨èï¼‰**
```bash
åŒå‡» run_test_data.bat
```

**æ–¹å¼2ï¼šå‘½ä»¤è¡Œæ‰§è¡Œ**
```bash
# æ‰§è¡Œæ‰€æœ‰æµ‹è¯•
pytest testcases/ -v

# æ‰§è¡Œé€šç”¨æµ‹è¯•
pytest testcases/test_common.py -v

# æ‰§è¡Œç‹¬ç«‹æµ‹è¯•
pytest testcases/dl_test.py -v

# ç”ŸæˆAllureæŠ¥å‘Š
pytest testcases/ --alluredir=allure-results -v
allure serve allure-results
```

## ğŸ“ æµ‹è¯•ç”¨ä¾‹ç¼–å†™

### é€šç”¨æ¨¡å¼ï¼ˆæ¨èï¼‰

é€‚ç”¨äºæ ‡å‡†APIæµ‹è¯•ï¼Œæ— éœ€ç¼–å†™ä»£ç ã€‚

#### CSVæ ¼å¼

**æ–‡ä»¶ä½ç½®**ï¼š`data_csv/test_login.csv`

```csv
test_case_id,test_case_name,api_name,method,url,headers,request_data,expected_status_code,expected_response,test_type,priority,description,preconditions,postconditions,tags
TC001,æµ‹è¯•ç™»å½•,ç™»å½•æ¥å£,POST,/api/login,"{""Content-Type"": ""application/json""}","{""username"": ""admin"", ""password"": ""123456""}",200,"{""code"": ""200""}",positive,high,éªŒè¯ç™»å½•æˆåŠŸ,,-,"login,smoke"
```

**æ³¨æ„**ï¼š
- JSONå­—æ®µéœ€è¦è½¬ä¹‰åŒå¼•å·ï¼ˆ`""`ï¼‰
- tagsä½¿ç”¨é€—å·åˆ†éš”

#### YAMLæ ¼å¼ï¼ˆæ¨èï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`data_yaml/test_login.yaml`

```yaml
test_cases:
  - test_case_id: "TC001"
    test_case_name: "æµ‹è¯•ç™»å½•"
    api_name: "ç™»å½•æ¥å£"
    method: "POST"
    url: "/api/login"
    headers:
      Content-Type: "application/json"
    request_data:
      username: "admin"
      password: "123456"
    expected_status_code: 200
    expected_response:
      code: "200"
      message: "æˆåŠŸ"
    test_type: "positive"
    priority: "high"
    description: "éªŒè¯ç™»å½•æˆåŠŸ"
    preconditions: "token"
    postconditions: "-"
    tags:
      - "login"
      - "smoke"
```

**ä¼˜åŠ¿**ï¼š
- ç»“æ„æ¸…æ™°ï¼Œæ˜“äºé˜…è¯»
- ä¸éœ€è¦è½¬ä¹‰JSON
- æ”¯æŒå¤æ‚åµŒå¥—ç»“æ„

### ç‹¬ç«‹æ¨¡å¼

é€‚ç”¨äºéœ€è¦è‡ªå®šä¹‰é€»è¾‘çš„ç‰¹æ®Šæµ‹è¯•åœºæ™¯ã€‚

#### æ­¥éª¤1ï¼šåˆ›å»ºæµ‹è¯•ç”¨ä¾‹

æ–‡ä»¶åå¿…é¡»ä»¥ `dl_` å¼€å¤´ï¼š
- `data_yaml/dl_special.yaml`
- `data_csv/dl_complex.csv`

#### æ­¥éª¤2ï¼šç”Ÿæˆæµ‹è¯•è„šæœ¬

```bash
python generate_dl_test.py data_yaml/dl_special.yaml
# ç”Ÿæˆ testcases/dl_special.py
```

#### æ­¥éª¤3ï¼šè‡ªå®šä¹‰è„šæœ¬ï¼ˆå¯é€‰ï¼‰

ç”Ÿæˆçš„è„šæœ¬å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ï¼Œæ·»åŠ è‡ªå®šä¹‰é€»è¾‘ã€‚

## ğŸ”§ å­—æ®µè¯´æ˜

| å­—æ®µå | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|
| test_case_id | âœ… | æµ‹è¯•ç”¨ä¾‹å”¯ä¸€ID | TC001 |
| test_case_name | âœ… | æµ‹è¯•ç”¨ä¾‹åç§° | æµ‹è¯•ç™»å½• |
| api_name | âœ… | æ¥å£åç§° | ç™»å½•æ¥å£ |
| method | âœ… | HTTPæ–¹æ³• | GET/POST/PUT/DELETE |
| url | âœ… | æ¥å£è·¯å¾„ | /api/login |
| headers | âŒ | è¯·æ±‚å¤´ | {"Content-Type": "application/json"} |
| request_data | âŒ | è¯·æ±‚æ•°æ® | {"username": "admin"} |
| expected_status_code | âœ… | æœŸæœ›çŠ¶æ€ç  | 200 |
| expected_response | âŒ | æœŸæœ›å“åº” | {"code": "200"} |
| test_type | âŒ | æµ‹è¯•ç±»å‹ | positive/negative/boundary |
| priority | âŒ | ä¼˜å…ˆçº§ | high/medium/low |
| description | âŒ | æµ‹è¯•æè¿° | éªŒè¯ç™»å½•æˆåŠŸ |
| preconditions | âŒ | å‰ç½®æ¡ä»¶ | token/æƒé™ä¸è¶³/æœªç™»å½•/- |
| postconditions | âŒ | åç½®æ¡ä»¶ | - |
| tags | âŒ | æ ‡ç­¾ | login,smoke |

## ğŸ” å‰ç½®æ¡ä»¶å¤„ç†

æ¡†æ¶ä¼šæ ¹æ® `preconditions` å­—æ®µè‡ªåŠ¨å¤„ç†è®¤è¯ï¼š

| å‰ç½®æ¡ä»¶å…³é”®è¯ | å¤„ç†æ–¹å¼ |
|--------------|---------|
| token / è®¤è¯ / ç™»å½• | è‡ªåŠ¨ç™»å½•è·å–token |
| æƒé™ä¸è¶³ / æ— æƒé™ / ä½æƒé™ | ä½¿ç”¨ä½æƒé™token |
| æœªç™»å½• / æœªè®¤è¯ / æ— token | æ¸…é™¤è®¤è¯ä¿¡æ¯ |
| - æˆ–ç©º | ä¸åšç‰¹æ®Šå¤„ç† |

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

### ç”ŸæˆAllureæŠ¥å‘Š

```bash
# æ‰§è¡Œæµ‹è¯•å¹¶ç”ŸæˆæŠ¥å‘Šæ•°æ®
pytest testcases/ --alluredir=allure-results -v

# å¯åŠ¨AllureæœåŠ¡æŸ¥çœ‹æŠ¥å‘Š
allure serve allure-results
```

### æŠ¥å‘Šå†…å®¹

- âœ… æµ‹è¯•ç”¨ä¾‹IDå’Œåç§°
- âœ… æµ‹è¯•æè¿°å’Œä¼˜å…ˆçº§
- âœ… æ ‡ç­¾åˆ†ç±»
- âœ… è¯·æ±‚è¯¦æƒ…ï¼ˆURLã€æ–¹æ³•ã€å‚æ•°ï¼‰
- âœ… å“åº”è¯¦æƒ…ï¼ˆçŠ¶æ€ç ã€å“åº”ä½“ï¼‰
- âœ… æ–­è¨€ç»“æœ
- âœ… æ‰§è¡Œæ—¶é—´å’ŒçŠ¶æ€

## ğŸ¨ é«˜çº§ç”¨æ³•

### 1. æŒ‰æ ‡ç­¾è¿‡æ»¤

```bash
# æ‰§è¡Œsmokeæµ‹è¯•
pytest testcases/ -v -m "smoke"

# æ‰§è¡Œloginç›¸å…³æµ‹è¯•
pytest testcases/ -v -m "login"
```

### 2. æŒ‰ç”¨ä¾‹IDè¿‡æ»¤

```bash
# æ‰§è¡ŒæŒ‡å®šç”¨ä¾‹
pytest testcases/ -v -k "TC001"

# æ‰§è¡Œå¤šä¸ªç”¨ä¾‹
pytest testcases/ -v -k "TC001 or TC002"
```

### 3. å¤±è´¥é‡è¯•

```bash
# å¤±è´¥åé‡è¯•2æ¬¡
pytest testcases/ -v --reruns 2
```

### 4. å¹¶è¡Œæ‰§è¡Œ

```bash
# ä½¿ç”¨4ä¸ªè¿›ç¨‹å¹¶è¡Œæ‰§è¡Œ
pytest testcases/ -v -n 4
```

### 5. åªæ‰§è¡ŒCSVæˆ–YAML

```bash
# åªæ‰§è¡ŒCSVæ ¼å¼æµ‹è¯•ç”¨ä¾‹
pytest testcases/test_common.py --data-dir=data_csv -v

# åªæ‰§è¡ŒYAMLæ ¼å¼æµ‹è¯•ç”¨ä¾‹
pytest testcases/test_common.py --data-dir=data_yaml -v
```

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæ‰¾ä¸åˆ°æµ‹è¯•ç”¨ä¾‹

**ç°è±¡**ï¼š
```
collected 0 items
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆ.csv æˆ– .yamlï¼‰
3. æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦ç¬¦åˆæ ¼å¼è¦æ±‚

### é—®é¢˜2ï¼šJSONè§£æé”™è¯¯

**ç°è±¡**ï¼š
```
JSONDecodeError: Expecting property name enclosed in double quotes
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- CSVæ–‡ä»¶ï¼šJSONå­—æ®µéœ€è¦è½¬ä¹‰åŒå¼•å·ï¼ˆ`""`ï¼‰
- YAMLæ–‡ä»¶ï¼šç›´æ¥ä½¿ç”¨å­—å…¸æ ¼å¼ï¼Œä¸éœ€è¦è½¬ä¹‰

### é—®é¢˜3ï¼šè®¤è¯å¤±è´¥

**ç°è±¡**ï¼š
```
AssertionError: Expected status code 200, but got 401
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `config/config.yaml` ä¸­çš„è®¤è¯é…ç½®
2. ç¡®è®¤å‰ç½®æ¡ä»¶å­—æ®µæ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥tokenæ˜¯å¦è¿‡æœŸ

### é—®é¢˜4ï¼šç¼–ç é”™è¯¯

**ç°è±¡**ï¼š
```
UnicodeDecodeError: 'gbk' codec can't decode byte
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
ç¡®ä¿æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ä½¿ç”¨ UTF-8 ç¼–ç ä¿å­˜

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ–‡ä»¶ç»„ç»‡

```
data_csv/
â”œâ”€â”€ test_login.csv          # ç™»å½•æ¨¡å—
â”œâ”€â”€ test_user.csv           # ç”¨æˆ·æ¨¡å—
â””â”€â”€ test_order.csv          # è®¢å•æ¨¡å—

data_yaml/
â”œâ”€â”€ test_complex_api.yaml   # å¤æ‚æ¥å£
â””â”€â”€ test_integration.yaml   # é›†æˆæµ‹è¯•
```

### 2. ç”¨ä¾‹å‘½å

- æ–‡ä»¶åï¼š`test_æ¨¡å—å.csv` æˆ– `test_æ¨¡å—å.yaml`
- ç”¨ä¾‹IDï¼š`TC001`ã€`TC002`...ï¼ˆæ•°å­—é€’å¢ï¼‰

### 3. æ ‡ç­¾ä½¿ç”¨

```yaml
tags:
  - "smoke"      # å†’çƒŸæµ‹è¯•
  - "regression" # å›å½’æµ‹è¯•
  - "login"      # åŠŸèƒ½æ¨¡å—
  - "high"       # ä¼˜å…ˆçº§
```

### 4. æ ¼å¼é€‰æ‹©

- **ç®€å•æµ‹è¯•ç”¨ä¾‹** â†’ CSVæ ¼å¼
  - å‚æ•°å°‘ã€ç»“æ„ç®€å•
  - æ˜“äºExcelç¼–è¾‘
  
- **å¤æ‚æµ‹è¯•ç”¨ä¾‹** â†’ YAMLæ ¼å¼
  - å‚æ•°å¤šã€åµŒå¥—ç»“æ„
  - æ˜“äºé˜…è¯»ç»´æŠ¤

### 5. æ¨¡å¼é€‰æ‹©

| åœºæ™¯ | æ¨èæ¨¡å¼ | åŸå›  |
|------|---------|------|
| æ ‡å‡†APIæµ‹è¯• | é€šç”¨æ¨¡å¼ | ç®€å•å¿«é€Ÿï¼Œæ— éœ€ç¼–å†™ä»£ç  |
| æ‰¹é‡æµ‹è¯•ç”¨ä¾‹ | é€šç”¨æ¨¡å¼ | ç»Ÿä¸€ç®¡ç†ï¼Œæ˜“äºç»´æŠ¤ |
| å¤æ‚ä¸šåŠ¡é€»è¾‘ | ç‹¬ç«‹æ¨¡å¼ | å¯è‡ªå®šä¹‰å¤„ç†é€»è¾‘ |
| ç‰¹æ®Šæ–­è¨€éœ€æ±‚ | ç‹¬ç«‹æ¨¡å¼ | å¯è‡ªå®šä¹‰æ–­è¨€é€»è¾‘ |

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [docs/authentication_guide.md](docs/authentication_guide.md) - è®¤è¯æ–¹æ¡ˆè¯¦ç»†è¯´æ˜
- [docs/captcha_guide.md](docs/captcha_guide.md) - éªŒè¯ç å¤„ç†æŒ‡å—

## ğŸ”„ ç‰ˆæœ¬å†å²

### v3.0 (2024-11-28)
- âœ… å®ç°æ··åˆæ¨¡å¼ï¼ˆé€šç”¨ + ç‹¬ç«‹ï¼‰
- âœ… æ”¯æŒ CSV å’Œ YAML æ ¼å¼
- âœ… è‡ªåŠ¨ç”Ÿæˆç‹¬ç«‹æµ‹è¯•è„šæœ¬
- âœ… æ™ºèƒ½è®¤è¯å¤„ç†
- âœ… ä¸€é”®æ‰§è¡Œæ‰€æœ‰æµ‹è¯•

### v2.0 (2024-11-27)
- âœ… é€šç”¨æµ‹è¯•è„šæœ¬
- âœ… è‡ªåŠ¨æ‰«ææµ‹è¯•ç”¨ä¾‹
- âœ… AllureæŠ¥å‘Šé›†æˆ

### v1.0 (2024-11-26)
- âœ… åŸºç¡€æ¡†æ¶æ­å»º
- âœ… APIå®¢æˆ·ç«¯å°è£…
- âœ… æ–­è¨€å·¥å…·

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. æœ¬æ–‡æ¡£çš„æ•…éšœæ’æŸ¥ç« èŠ‚
2. docs/ ç›®å½•ä¸‹çš„è¯¦ç»†æ–‡æ¡£
3. æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹æ–‡ä»¶

---

**ç‰ˆæœ¬**ï¼šv3.0  
**æ›´æ–°æ—¶é—´**ï¼š2024-11-28  
**çŠ¶æ€**ï¼šâœ… ç”Ÿäº§å°±ç»ª
